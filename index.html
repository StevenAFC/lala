<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Best Day Eva</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
      :root {
        --bg-gradient: linear-gradient(
          -45deg,
          #ff6b6b,
          #556270,
          #4ecdc4,
          #c7f464
        );
        --glass-bg: rgba(255, 255, 255, 0.9);
        --glass-border: rgba(255, 255, 255, 0.4);
        --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        --text-color: #2d3748;
        --weekend-color: #cbd5e0;
        --best-day-gold: #f6ad55;
        --pop-green-start: #00ff87;
        --pop-green-end: #60efff;
        --bar-day-color: linear-gradient(90deg, #2c3e50 0%, #4ca1af 100%);
        --bar-time-color: linear-gradient(90deg, #ff8008 0%, #ffc837 100%);
      }

      body {
        font-family:
          "Segoe UI",
          system-ui,
          -apple-system,
          sans-serif;
        background: var(--bg-gradient);
        background-size: 400% 400%;
        animation: gradientBG 20s ease infinite;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 10px;
        box-sizing: border-box;
        color: var(--text-color);
        overflow-y: auto;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .dashboard {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid white;
        width: 100%;
        max-width: 950px;
        padding: 25px 30px;
        border-radius: 20px;
        box-shadow: var(--glass-shadow);
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      /* --- Progress Bars --- */
      .bar-group {
        margin-bottom: 5px;
      }
      .bar-label {
        font-weight: 800;
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        color: #4a5568;
      }
      .progress-container {
        height: 16px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(200, 200, 200, 0.5);
      }
      .progress-fill {
        height: 100%;
        width: 0%;
        transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        border-radius: 8px;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }
      #day-bar {
        background: var(--bar-day-color);
      }
      #time-bar {
        background: var(--bar-time-color);
      }

      /* --- Calendar --- */
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
      }
      .cal-header {
        text-align: center;
        font-weight: 800;
        font-size: 0.8rem;
        color: #718096;
        padding-bottom: 2px;
      }
      .cal-cell {
        background: white;
        height: 45px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        cursor: default;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: transform 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
      }
      .cal-cell.weekend {
        background: var(--weekend-color);
        border-color: #a0aec0;
        opacity: 0.8;
      }
      .cal-cell.empty {
        background: transparent;
        border: none;
        box-shadow: none;
      }
      .cal-cell.past {
        background: linear-gradient(
          135deg,
          var(--pop-green-start),
          var(--pop-green-end)
        );
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.8);
        animation: softWiggle 3s infinite ease-in-out;
        z-index: 1;
      }
      .check-mark {
        font-size: 1.4rem;
        font-weight: 900;
        line-height: 1;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      /* --- Split Timer --- */
      .timer-container {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
      }
      .timer-pill {
        background: #1a202c;
        color: #fff;
        padding: 10px;
        border-radius: 14px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 15px -5px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .timer-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        opacity: 0.7;
        margin-bottom: 2px;
      }
      .timer-value {
        font-family: "Courier New", Courier, monospace;
        font-weight: 700;
        font-size: 1.2rem;
        letter-spacing: -1px;
      }
      .pill-work .timer-value {
        color: #f6ad55;
        text-shadow: 0 0 10px rgba(246, 173, 85, 0.5);
      }
      .pill-awake .timer-value {
        color: #63b3ed;
      }
      .pill-total .timer-value {
        color: #e2e8f0;
      }

      /* --- Stats Grid --- */
      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .stat-card {
        padding: 12px;
        border-radius: 14px;
        text-align: center;
        font-weight: 700;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s;
      }
      .stat-card:hover {
        transform: translateY(-3px) scale(1.02);
      }
      .stat-blue {
        background: linear-gradient(
          135deg,
          rgba(227, 242, 253, 0.9),
          rgba(187, 222, 251, 0.95)
        );
        color: #0d47a1;
      }
      .stat-green {
        background: linear-gradient(
          135deg,
          rgba(232, 245, 233, 0.9),
          rgba(200, 230, 201, 0.95)
        );
        color: #1b5e20;
      }
      .stat-gold {
        background: linear-gradient(
          135deg,
          rgba(255, 248, 225, 0.9),
          rgba(255, 236, 179, 0.95)
        );
        color: #f57f17;
      }
      .stat-red {
        background: linear-gradient(
          135deg,
          rgba(255, 235, 238, 0.95),
          rgba(255, 205, 210, 1)
        );
        color: #b71c1c;
        border: 1px solid #ef9a9a;
      }

      /* --- NEW FLIGHT TRACKER STYLES --- */
      .flight-card {
        /* Replace your existing background with this */
        background: linear-gradient(
          -45deg,
          rgba(255, 255, 255, 0.7),
          rgba(255, 255, 255, 0.3),
          rgba(96, 239, 255, 0.15),
          rgba(246, 173, 85, 0.15)
        );
        background-size: 300% 300%;
        animation: cardSkyPan 15s ease infinite;

        /* Keep your existing border, padding, radius, etc. */
        border: 1px solid rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        padding: 20px 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        position: relative;
        overflow: hidden; /* Keeps the background contained */
      }

      /* Add this with your other animations */
      @keyframes cardSkyPan {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .flight-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px; /* Space for the track labels */
      }

      .flight-title {
        font-weight: 800;
        font-size: 1.1rem;
        color: #2d3748;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .flight-link {
        background: linear-gradient(90deg, #ff8008 0%, #ffc837 100%);
        color: white;
        text-decoration: none;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 10px rgba(255, 128, 8, 0.3);
        transition: all 0.2s ease;
      }

      .flight-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 128, 8, 0.5);
      }

      .flight-track {
        position: relative;
        height: 8px;
        background: rgba(0, 0, 0, 0.08);
        border-radius: 10px;
        margin: 0 10px 20px 10px;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.15);
      }

      /* Origin and Destination Dots */
      .flight-track::before,
      .flight-track::after {
        content: "";
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: white;
        z-index: 5;
      }

      .flight-track::before {
        left: -7px;
        border: 3px solid var(--best-day-gold);
      }

      .flight-track::after {
        right: -7px;
        border: 3px solid #ff8008;
        /* Add the animation line here */
        animation: radarPulse 2s infinite;
      }

      /* Add this new animation block right below it */
      @keyframes radarPulse {
        0% {
          box-shadow: 0 0 0 0 rgba(255, 128, 8, 0.8);
        }
        70% {
          box-shadow: 0 0 0 12px rgba(255, 128, 8, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(255, 128, 8, 0);
        }
      }

      /* Origin and Destination Labels */
      .track-labels {
        position: absolute;
        top: -26px;
        left: -5px;
        width: calc(100% + 10px);
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        font-weight: 900;
        letter-spacing: 1px;
        color: #2c3e50;
        text-shadow: 0 2px 5px rgba(255, 255, 255, 0.8);
      }

      /* Make LHR pop a bit more since it's the destination */
      .track-labels span:last-child {
        color: #ff8008;
        text-shadow: 0 0 10px rgba(255, 128, 8, 0.3);
      }

      #flight-progress-fill {
        position: relative;
        top: 0;
        left: 0;
        height: 100%;
        background: linear-gradient(90deg, var(--best-day-gold), #ff8008);
        border-radius: 10px;
        width: 0%;
        transition: width 1s linear;
        box-shadow: 0 0 10px rgba(255, 128, 8, 0.4);
        z-index: 1;
      }

      #flight-progress-fill::after {
        content: "";
        position: absolute;
        right: -4px; /* Hangs slightly off the end of the fill */
        top: -2px; /* Centers it over the 8px tall track */
        height: 12px;
        width: 12px;
        background: #ffffff;
        border-radius: 50%;
        box-shadow:
          0 0 10px #ffffff,
          0 0 20px var(--best-day-gold);
        z-index: 2;
      }

      .flight-plane {
        position: absolute;
        top: -16px;
        left: 0%;
        font-size: 1.6rem;
        transition: left 1s linear;
        transform: translateX(-25%) rotate(45deg);
        z-index: 10;
        /* Removed the old drop-shadow filter from here */
        animation: flightBob 2.5s ease-in-out infinite;
      }

      /* THE NEW SHADOW EMOJI */
      .flight-plane::before {
        content: "‚úàÔ∏è";
        position: absolute;
        top: 0;
        left: 0;
        z-index: -2; /* Tucks it behind the main plane and contrail */
        animation: shadowBob 2.5s ease-in-out infinite;
      }

      /* Contrail code stays the same, just keeping it here for reference */
      .flight-plane::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: -8px;
        width: 18px;
        height: 6px;
        background: rgba(65, 62, 62, 0.267);
        border-radius: 10px;
        filter: blur(3px);
        z-index: -1;
        animation: contrailPulse 0.6s infinite alternate;
      }

      /* Plane Bobs Up */
      @keyframes flightBob {
        0%,
        100% {
          margin-top: 0px;
        }
        50% {
          margin-top: -8px;
        } /* Floats higher */
      }

      /* Shadow reacts to the bob */
      @keyframes shadowBob {
        0%,
        100% {
          /* Tighter, darker shadow when plane is low */
          transform: translate(-2px, 4px) scale(1);
          filter: grayscale(100%) brightness(0) opacity(0.4) blur(1px);
        }
        50% {
          /* Shadow pushes further down and gets softer/smaller when plane floats up */
          transform: translate(-8px, 14px) scale(0.85);
          filter: grayscale(100%) brightness(0) opacity(0.15) blur(4px);
        }
      }

      /* The Exhaust Pulsing Animation */
      @keyframes contrailPulse {
        0% {
          opacity: 0.4;
          /* Added rotate(-45deg) before the scale and translate */
          transform: rotate(-45deg) scaleX(0.8) translateX(0);
        }
        100% {
          opacity: 0.9;
          /* Added rotate(-45deg) here too so it stays angled while stretching */
          transform: rotate(-45deg) scaleX(1.5) translateX(-4px);
        }
      }

      .flight-status-text {
        text-align: center;
        font-size: 0.9rem;
        font-weight: 700;
        color: #4a5568;
        background: rgba(255, 255, 255, 0.5);
        padding: 8px;
        border-radius: 10px;
        display: inline-block;
        width: 100%;
        box-sizing: border-box;
      }

      /* --- SUMMARY FOOTER --- */
      .summary-section {
        background: rgba(45, 55, 72, 0.05);
        border-top: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 14px;
        padding: 15px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-top: 10px;
      }
      .summary-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .summary-item:not(:last-child)::after {
        content: "";
        position: absolute;
        right: 0;
        top: 20%;
        height: 60%;
        width: 1px;
        background: rgba(0, 0, 0, 0.1);
      }
      .summary-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        color: #718096;
        font-weight: 700;
        letter-spacing: 0.5px;
        margin-bottom: 2px;
      }
      .summary-val {
        font-size: 1.1rem;
        font-weight: 800;
        color: #2d3748;
      }
      .summary-sub {
        font-size: 0.75rem;
        color: #718096;
        font-weight: 400;
      }

      /* --- Animations --- */
      @keyframes softWiggle {
        0%,
        100% {
          transform: rotate(0deg);
        }
        2% {
          transform: rotate(-3deg);
        }
        4% {
          transform: rotate(3deg);
        }
        6% {
          transform: rotate(-3deg);
        }
        8% {
          transform: rotate(3deg);
        }
        10% {
          transform: rotate(0deg);
        }
      }
      @keyframes todayPulse {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(246, 173, 85, 0.7);
        }
        70% {
          transform: scale(1.05);
          box-shadow: 0 0 0 10px rgba(246, 173, 85, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(246, 173, 85, 0);
        }
      }
      .cal-cell.today {
        background: white;
        border: 3px solid var(--best-day-gold);
        z-index: 2;
        animation: todayPulse 2s infinite;
      }
      .cal-cell.arsenal {
        background: #fc8181;
        color: white;
      }
      .date-num {
        font-size: 0.8rem;
        font-weight: bold;
      }
      .status-icon {
        font-size: 1.1rem;
        margin-top: 1px;
      }

      /* --- Digit Animation Helpers --- */
      .digit-group {
        display: inline-block;
        position: relative;
        height: 1.2em;
        width: 1ch;
        text-align: center;
        overflow: hidden;
        vertical-align: middle;
      }
      .digit-group[data-value=" "] {
        visibility: hidden;
      }
      .digit-group span {
        display: block;
        position: absolute;
        left: 0;
        right: 0;
        text-align: center;
      }
      .digit-group span.rolling-up {
        animation: slide-up 0.5s ease-in-out forwards;
      }
      .digit-group span.rolling-up::before {
        content: attr(data-new-val);
        position: absolute;
        left: 0;
        right: 0;
        top: 100%;
      }
      @keyframes slide-up {
        from {
          transform: translateY(0);
        }
        to {
          transform: translateY(-100%);
        }
      }

      /* --- Mobile --- */
      @media (max-width: 650px) {
        body {
          display: block;
          overflow-y: auto;
          height: auto;
        }
        .dashboard {
          padding: 15px;
          height: auto;
        }
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .timer-container {
          grid-template-columns: 1fr;
          gap: 10px;
        }
        .timer-value {
          font-size: 1.8rem;
        }
        .cal-cell {
          height: 45px;
        }
        .summary-section {
          grid-template-columns: 1fr 1fr;
          gap: 20px 10px;
        }
        .summary-item:not(:last-child)::after {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard">
      <div>
        <div class="bar-group">
          <div class="bar-label">
            <span>Day Progress</span>
            <span id="day-percent">0%</span>
          </div>
          <div class="progress-container">
            <div id="day-bar" class="progress-fill"></div>
          </div>
        </div>

        <div class="bar-group">
          <div class="bar-label">
            <span>Time Progress</span>
            <span id="time-percent">0%</span>
          </div>
          <div class="progress-container">
            <div id="time-bar" class="progress-fill"></div>
          </div>
        </div>
      </div>

      <div class="calendar-grid" id="calendar"></div>

      <div class="timer-container" id="main-timer"></div>

      <div class="stats-grid">
        <div class="stat-card stat-blue" id="stat-sleeps">Loading...</div>
        <div class="stat-card stat-green" id="stat-weekends">Loading...</div>
        <div class="stat-card stat-gold" id="stat-milestone">Loading...</div>
        <div class="stat-card stat-red" id="stat-arsenal">Loading...</div>
      </div>

      <div class="flight-card">
        <div class="flight-header">
          <div class="flight-title">‚úàÔ∏è TG916</div>
          <a
            href="https://www.flightradar24.com/data/flights/tg916"
            target="_blank"
            class="flight-link"
            >Live Map üìç</a
          >
        </div>
        <div class="flight-track">
          <div class="track-labels">
            <span>BKK</span>
            <span>LHR</span>
          </div>
          <div id="flight-progress-fill"></div>
          <div id="flight-plane" class="flight-plane">‚úàÔ∏è</div>
        </div>
        <div class="flight-status-text" id="flight-status">
          Loading flight data...
        </div>
      </div>
      <div class="summary-section">
        <div class="summary-item">
          <div class="summary-label">Total Duration</div>
          <div class="summary-val">
            <span id="sum-days">0</span> <span class="summary-sub">Days</span>
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Hours</div>
          <div class="summary-val">
            <span id="sum-hours">0</span> <span class="summary-sub">hrs</span>
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Awake Time</div>
          <div class="summary-val">
            <span id="sum-awake">0</span> <span class="summary-sub">hrs</span>
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Est. Work</div>
          <div class="summary-val">
            ~<span id="sum-work">0</span> <span class="summary-sub">hrs</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      const START_DATE = new Date("2026-01-29T00:00:00");
      const TARGET_DATE_MATH = new Date("2026-02-26T00:00:00");
      const TARGET_DATE_EXACT = new Date("2026-02-26T09:30:00");
      const ARSENAL_GAMES = [
        new Date(2026, 1, 7, 15, 0),
        new Date(2026, 1, 12, 20, 0),
        new Date(2026, 1, 15, 16, 30),
        new Date(2026, 1, 18, 20, 0),
        new Date(2026, 1, 22, 16, 30),
      ];
      const FLIGHT_DEPARTURE = new Date("2026-02-24T06:20:00Z"); // 06:20 GMT
      const FLIGHT_ARRIVAL = new Date("2026-02-24T19:35:00Z"); // 19:35 GMT

      let confettiLaunched = false;
      let today = new Date().toDateString();

      // --- Variables for animated timer ---
      let timersInitialized = false;
      const previousTimes = {
        work: { h: [" ", " ", " ", " "], m: ["0", "0"], s: ["0", "0"] },
        awake: { h: [" ", " ", " ", " "], m: ["0", "0"], s: ["0", "0"] },
        total: { h: [" ", " ", " ", " "], m: ["0", "0"], s: ["0", "0"] },
      };

      function pad(n) {
        return n < 10 ? "0" + n : "" + n;
      }

      function initTimers() {
        if (timersInitialized) return;
        const timerContainer = document.getElementById("main-timer");

        ["work", "awake", "total"].forEach((type) => {
          const pill = document.createElement("div");
          pill.className = `timer-pill pill-${type}`;

          const label = document.createElement("div");
          label.className = "timer-label";
          label.textContent =
            type === "work"
              ? "Work Left"
              : type === "awake"
                ? "Awake Hours"
                : "Total Time";

          const value = document.createElement("div");
          value.className = "timer-value";

          let html = "";
          for (let i = 0; i < 4; i++) {
            html += `<div class="digit-group hours" id="group-${type}-h-${i}" data-value=" "><span id="${type}-h-${i}"> </span></div>`;
          }
          html += '<span class="unit">h </span>';

          for (let i = 0; i < 2; i++) {
            html += `<div class="digit-group"><span id="${type}-m-${i}">0</span></div>`;
          }
          html += '<span class="unit">m </span>';

          for (let i = 0; i < 2; i++) {
            html += `<div class="digit-group"><span id="${type}-s-${i}">0</span></div>`;
          }
          html += '<span class="unit">s</span>';

          value.innerHTML = html;
          pill.appendChild(label);
          pill.appendChild(value);
          timerContainer.appendChild(pill);
        });

        timersInitialized = true;
      }

      function updateSpan(elementId, from, to) {
        if (from === to) return;
        const element = document.getElementById(elementId);
        if (!element || element.classList.contains("rolling-up")) return;

        element.dataset.newVal = to;
        element.classList.add("rolling-up");

        let animationFinished = false;
        const handleAnimationEnd = () => {
          if (animationFinished) return;
          animationFinished = true;
          element.textContent = to;
          element.classList.remove("rolling-up");
          element.removeAttribute("data-new-val");
        };

        element.addEventListener("animationend", handleAnimationEnd, {
          once: true,
        });
        setTimeout(handleAnimationEnd, 550);
      }

      function updateTimer(type, newTimeDigits) {
        const prevTimeDigits = previousTimes[type];
        newTimeDigits.h.forEach((digit, i) => {
          const id = `${type}-h-${i}`;
          updateSpan(id, prevTimeDigits.h[i], digit);
          const digitGroup = document.getElementById(id).parentElement;
          if (digitGroup) digitGroup.dataset.value = digit;
        });
        newTimeDigits.m.forEach((digit, i) =>
          updateSpan(`${type}-m-${i}`, prevTimeDigits.m[i], digit),
        );
        newTimeDigits.s.forEach((digit, i) =>
          updateSpan(`${type}-s-${i}`, prevTimeDigits.s[i], digit),
        );
        previousTimes[type] = newTimeDigits;
      }

      function msToTimeDigits(ms) {
        if (ms < 0) ms = 0;
        const h = Math.floor(ms / (1000 * 60 * 60));
        const m = Math.floor((ms / (1000 * 60)) % 60);
        const s = Math.floor((ms / 1000) % 60);

        return {
          h: String(h).padStart(4, " ").split(""),
          m: pad(m).split(""),
          s: pad(s).split(""),
        };
      }

      function update() {
        const now = new Date();
        if (now.toDateString() !== today) {
          today = now.toDateString();
          renderCal();
        }

        const diffMs = TARGET_DATE_EXACT - now;

        if (diffMs <= 0) {
          document.getElementById("main-timer").innerHTML =
            `<div class="timer-pill pill-work" style="grid-column: span 3;">
                 <div class="timer-value">üöÄ IT'S TIME!</div>
             </div>`;
          document.title = "üéâ IT'S TIME! üéâ";
          if (!confettiLaunched) {
            launchConfetti();
            confettiLaunched = true;
          }
          return;
        }

        initTimers();

        const totalDurationMs = TARGET_DATE_EXACT - START_DATE;
        const elapsedMs = now - START_DATE;
        const timePct = Math.min(
          100,
          Math.max(0, (elapsedMs / totalDurationMs) * 100),
        );

        const nowMidnight = new Date(now);
        nowMidnight.setHours(0, 0, 0, 0);
        const totalDays = Math.round(
          (TARGET_DATE_MATH - START_DATE) / (1000 * 60 * 60 * 24),
        );
        const daysPassed = Math.round(
          (nowMidnight - START_DATE) / (1000 * 60 * 60 * 24),
        );
        const dayPct = Math.min(
          100,
          Math.max(0, (daysPassed / totalDays) * 100),
        );

        const timeInverse = 100 - timePct;
        document.getElementById("time-bar").style.width = timePct + "%";
        document.getElementById("time-percent").innerText =
          timePct.toFixed(4) + "% (" + timeInverse.toFixed(4) + "%)";

        const dayInverse = 100 - dayPct;
        document.getElementById("day-bar").style.width = dayPct + "%";
        document.getElementById("day-percent").innerText =
          dayPct.toFixed(4) + "% (" + dayInverse.toFixed(4) + "%)";

        let sleeps = 0;
        let counter = new Date(now);
        counter.setHours(7, 0, 0, 0);
        if (now.getTime() >= counter.getTime()) {
          counter.setDate(counter.getDate() + 1);
        }
        while (counter < TARGET_DATE_EXACT) {
          sleeps++;
          counter.setDate(counter.getDate() + 1);
        }

        const mood =
          sleeps > 25
            ? "üò≠"
            : sleeps > 15
              ? "üò©"
              : sleeps > 10
                ? "üòê"
                : sleeps > 5
                  ? "üôÇ"
                  : "ü•≥";
        document.title = `(${sleeps} Sleeps) Best Day Countdown`;
        document.getElementById("stat-sleeps").innerHTML =
          `<span style="font-size:1.5rem">${mood}</span> <span>${sleeps} sleeps left!</span>`;

        let thurs = 0,
          sats = 0;
        let scanner = new Date(now);
        scanner.setHours(0, 0, 0, 0);
        for (let i = 1; i <= sleeps; i++) {
          scanner.setDate(scanner.getDate() + 1);
          if (scanner.getDay() === 4) thurs++;
          if (scanner.getDay() === 6) sats++;
        }
        thurs--;
        document.getElementById("stat-weekends").innerHTML =
          `<span style="font-size:1.5rem">üìÖ</span> <span>${thurs} Thursday(s) & ${sats} Weekend(s)</span>`;

        const milestones = [
          { p: 0, t: "Started" },
          { p: 10, t: "10% Complete" },
          { p: 20, t: "20% Complete" },
          { p: 25, t: "Quarter Way" },
          { p: 30, t: "30% Complete" },
          { p: 33, t: "Third of the Way" },
          { p: 40, t: "40% Complete" },
          { p: 50, t: "Midpoint" },
          { p: 60, t: "60% Complete" },
          { p: 70, t: "70% Complete" },
          { p: 75, t: "Home Stretch" },
          { p: 80, t: "80% Complete" },
          { p: 90, t: "Almost There" },
          { p: 100, t: "Complete" },
        ];
        let mileText = milestones[0].t;
        milestones.forEach((m) => {
          if (timePct >= m.p) mileText = m.t;
        });
        document.getElementById("stat-milestone").innerHTML =
          `<span style="font-size:1.5rem">üìà</span> <span>${mileText}</span>`;

        const gamesLeft = ARSENAL_GAMES.filter((gameStartTime) => {
          const gameEndTime = new Date(gameStartTime.getTime() + 105 * 60000);
          return gameEndTime > now;
        }).length;
        document.getElementById("stat-arsenal").innerHTML =
          `<span style="font-size:1.5rem">‚öΩ</span> <span>${gamesLeft} Arsenal games!</span>`;

        // --- Work Calculation ---
        const totalSleepMs = calculateTotalSleepMs(now, TARGET_DATE_EXACT);
        const awakeMs = diffMs > totalSleepMs ? diffMs - totalSleepMs : 0;

        let wDays = 0;
        let workScanner = new Date(now);
        workScanner.setDate(workScanner.getDate() + 1);
        workScanner.setHours(0, 0, 0, 0);
        const finalDayStart = new Date(TARGET_DATE_EXACT);
        finalDayStart.setHours(0, 0, 0, 0);

        while (workScanner < finalDayStart) {
          let day = workScanner.getDay();
          if (day !== 0 && day !== 6) wDays++;
          workScanner.setDate(workScanner.getDate() + 1);
        }

        let todayWorkMs = 0;
        if (now.getDay() !== 0 && now.getDay() !== 6) {
          const workStart = new Date(now);
          workStart.setHours(9, 0, 0, 0);
          const workEnd = new Date(now);
          workEnd.setHours(17, 30, 0, 0);
          if (now < workStart) todayWorkMs = 8.5 * 3600 * 1000;
          else if (now >= workStart && now < workEnd)
            todayWorkMs = workEnd - now;
        }

        let lastDayWorkMs = 0;
        const finalDate = new Date(TARGET_DATE_EXACT);
        if (finalDate.getDay() !== 0 && finalDate.getDay() !== 6) {
          const workStartOnFinalDay = new Date(finalDate);
          workStartOnFinalDay.setHours(9, 0, 0, 0);
          if (finalDate > workStartOnFinalDay)
            lastDayWorkMs = finalDate - workStartOnFinalDay;
        }

        const workMs = wDays * 8.5 * 3600 * 1000 + todayWorkMs + lastDayWorkMs;

        updateTimer("work", msToTimeDigits(workMs));
        updateTimer("awake", msToTimeDigits(awakeMs));
        updateTimer("total", msToTimeDigits(diffMs));

        // --- Flight TG916 Tracking Logic ---
        const flightStatus = document.getElementById("flight-status");
        const flightPlane = document.getElementById("flight-plane");
        const flightFill = document.getElementById("flight-progress-fill");

        if (now < FLIGHT_DEPARTURE) {
          flightStatus.innerText = "Scheduled: Departs Tuesday at 06:20 GMT";
          flightPlane.style.left = "0%";
          flightFill.style.width = "0%";
        } else if (now >= FLIGHT_DEPARTURE && now <= FLIGHT_ARRIVAL) {
          const flightTotal = FLIGHT_ARRIVAL - FLIGHT_DEPARTURE;
          const flightElapsed = now - FLIGHT_DEPARTURE;
          const flightPct = Math.min(
            100,
            Math.max(0, (flightElapsed / flightTotal) * 100),
          );

          flightStatus.innerText = `üõ´ In the air! ${flightPct.toFixed(1)}% of the way to London!`;
          flightPlane.style.left = flightPct + "%";
          flightFill.style.width = flightPct + "%";
        } else {
          flightStatus.innerText = "üõ¨ Landed! She's home!";
          flightPlane.style.left = "100%";
          flightFill.style.width = "100%";
        }
      }

      function setTotalDuration() {
        const totalDurationMs = TARGET_DATE_EXACT - START_DATE;
        const totalDays = Math.floor(totalDurationMs / (1000 * 60 * 60 * 24));
        const totalHours = Math.floor(totalDurationMs / (1000 * 60 * 60));

        // Total Awake Hours
        const totalSleepMs = calculateTotalSleepMs(
          START_DATE,
          TARGET_DATE_EXACT,
        );
        const totalAwakeHours = Math.floor(
          (totalDurationMs - totalSleepMs) / (1000 * 60 * 60),
        );

        // Total Work Hours (Approximation)
        let totalWorkdays = 0;
        let currentDate = new Date(START_DATE);
        while (currentDate < TARGET_DATE_MATH) {
          const day = currentDate.getDay();
          if (day !== 0 && day !== 6) totalWorkdays++;
          currentDate.setDate(currentDate.getDate() + 1);
        }
        const totalWorkHours = Math.round(totalWorkdays * 8.5);

        document.getElementById("sum-days").innerText = totalDays;
        document.getElementById("sum-hours").innerText = totalHours;
        document.getElementById("sum-awake").innerText = totalAwakeHours;
        document.getElementById("sum-work").innerText = totalWorkHours;
      }

      function calculateTotalSleepMs(start, end) {
        let totalSleep = 0;
        let current = new Date(start);
        current.setHours(0, 0, 0, 0);

        // Limit loop to prevent infinite hang if dates are wrong
        let safety = 0;
        while (current < end && safety < 5000) {
          let sleepStart = new Date(current);
          sleepStart.setHours(23);
          let sleepEnd = new Date(current);
          sleepEnd.setDate(sleepEnd.getDate() + 1);
          sleepEnd.setHours(7);
          const overlap_start = Math.max(start.getTime(), sleepStart.getTime());
          const overlap_end = Math.min(end.getTime(), sleepEnd.getTime());
          if (overlap_end > overlap_start)
            totalSleep += overlap_end - overlap_start;
          current.setDate(current.getDate() + 1);
          safety++;
        }
        return totalSleep;
      }

      function launchConfetti() {
        var duration = 5 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        var interval = setInterval(function () {
          var timeLeft = animationEnd - Date.now();
          if (timeLeft <= 0) return clearInterval(interval);
          var particleCount = 50 * (timeLeft / duration);
          confetti(
            Object.assign({}, defaults, {
              particleCount,
              origin: { x: Math.random(), y: Math.random() - 0.2 },
            }),
          );
        }, 250);
      }

      function renderCal() {
        const grid = document.getElementById("calendar");
        grid.innerHTML = "";
        ["M", "T", "W", "T", "F", "S", "S"].forEach((d) => {
          let el = document.createElement("div");
          el.className = "cal-header";
          el.innerText = d;
          grid.appendChild(el);
        });

        let startDayIndex = START_DATE.getDay();
        let monStartIndex = startDayIndex === 0 ? 6 : startDayIndex - 1;
        for (let i = 0; i < monStartIndex; i++) {
          let empty = document.createElement("div");
          empty.className = "cal-cell empty";
          grid.appendChild(empty);
        }

        let cur = new Date(START_DATE);
        while (cur <= TARGET_DATE_EXACT) {
          let el = document.createElement("div");
          el.className = "cal-cell";
          let isPast = cur < new Date().setHours(0, 0, 0, 0);
          let isToday = cur.toDateString() === new Date().toDateString();
          let isArsenal = ARSENAL_GAMES.some(
            (g) => g.toDateString() === cur.toDateString(),
          );

          if (isPast) {
            el.classList.add("past");
            el.innerHTML = `<span class="check-mark">‚úî</span>`;
          } else if (isToday) {
            el.classList.add("today");
            el.innerHTML = isArsenal
              ? `<span class="date-num">${cur.getDate()}</span><span class="status-icon">‚öΩ</span>`
              : `<span class="date-num">${cur.getDate()}</span><span class="status-icon">üöÄ</span>`;
          } else {
            el.innerHTML = `<span class="date-num">${cur.getDate()}</span>`;
            if (isArsenal) {
              el.classList.add("arsenal");
              el.innerHTML += `<span class="status-icon">‚öΩ</span>`;
            } else if (cur.getDay() === 0 || cur.getDay() === 6) {
              el.classList.add("weekend");
            }
          }
          grid.appendChild(el);
          cur.setDate(cur.getDate() + 1);
        }
      }

      renderCal();
      setTotalDuration();
      setInterval(update, 1000);
      update();
    </script>
  </body>
</html>

